service: eng-metrics-api

frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x
  lambdaHashingVersion: '20201221'
  environment:
    ATLASSIAN_API_KEY : ${env:ATLASSIAN_API_KEY}
    GW_URL:
      Fn::Join:
        - ""
        - - "https://"
          - Ref: "ApiGatewayRestApi"
          - ".execute-api.${self:custom.region}.amazonaws.com/${self:custom.stage}"

plugins:
  - serverless-api-gateway-caching

custom:
  apiGatewayCaching:
    enabled: true
  stage: "${opt:stage, self:provider.stage}"
  region: "us-east-1"

functions:
  backlogs:
    handler: functions/backlog-handlers.backlogs
    events:
      - http:
         path: /backlogs
         method: get
  backlog-epics:
    handler: functions/backlog-handlers.backlogEpics
    timeout: 20
    events:
      - http:
          path: /backlogs/{backlogId}/epics
          method: get
          caching:
            enabled: true
            ttlInSeconds: 3600
            cacheKeyParameters:
              - name: request.path.backlogId
  epic-issues:
    handler: functions/backlog-handlers.epicIssues
    events:
        - http:
            path: /backlogs/{backlogId}/epics/{epicId}/epicIssues
            method: get
  export-backlog-epic-google-sheet:
      handler: functions/google-doc-handlers.exportBacklogEpicsGoogleSheet